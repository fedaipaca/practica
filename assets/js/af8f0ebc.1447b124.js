"use strict";(self.webpackChunkpractica_docs=self.webpackChunkpractica_docs||[]).push([[9872],{5680:(l,n,e)=>{e.d(n,{xA:()=>i,yg:()=>p});var t=e(6540);function r(l,n,e){return n in l?Object.defineProperty(l,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):l[n]=e,l}function g(l,n){var e=Object.keys(l);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(l);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(l,n).enumerable}))),e.push.apply(e,t)}return e}function u(l){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?g(Object(e),!0).forEach((function(n){r(l,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(e)):g(Object(e)).forEach((function(n){Object.defineProperty(l,n,Object.getOwnPropertyDescriptor(e,n))}))}return l}function o(l,n){if(null==l)return{};var e,t,r=function(l,n){if(null==l)return{};var e,t,r={},g=Object.keys(l);for(t=0;t<g.length;t++)e=g[t],n.indexOf(e)>=0||(r[e]=l[e]);return r}(l,n);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(l);for(t=0;t<g.length;t++)e=g[t],n.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(l,e)&&(r[e]=l[e])}return r}var y=t.createContext({}),a=function(l){var n=t.useContext(y),e=n;return l&&(e="function"==typeof l?l(n):u(u({},n),l)),e},i=function(l){var n=a(l.components);return t.createElement(y.Provider,{value:n},l.children)},s="mdxType",d={inlineCode:"code",wrapper:function(l){var n=l.children;return t.createElement(t.Fragment,{},n)}},c=t.forwardRef((function(l,n){var e=l.components,r=l.mdxType,g=l.originalType,y=l.parentName,i=o(l,["components","mdxType","originalType","parentName"]),s=a(e),c=r,p=s["".concat(y,".").concat(c)]||s[c]||d[c]||g;return e?t.createElement(p,u(u({ref:n},i),{},{components:e})):t.createElement(p,u({ref:n},i))}));function p(l,n){var e=arguments,r=n&&n.mdxType;if("string"==typeof l||r){var g=e.length,u=new Array(g);u[0]=c;var o={};for(var y in n)hasOwnProperty.call(n,y)&&(o[y]=n[y]);o.originalType=l,o[s]="string"==typeof l?l:r,u[1]=o;for(var a=2;a<g;a++)u[a]=e[a];return t.createElement.apply(null,u)}return t.createElement.apply(null,e)}c.displayName="MDXCreateElement"},3483:(l,n,e)=>{e.r(n),e.d(n,{assets:()=>y,contentTitle:()=>u,default:()=>d,frontMatter:()=>g,metadata:()=>o,toc:()=>a});var t=e(8168),r=(e(6540),e(5680));const g={sidebar_position:2,sidebar_label:"Monorepo"},u="Decision: Choosing **Monorepo** approach and tooling",o={unversionedId:"decisions/monorepo",id:"decisions/monorepo",title:"Decision: Choosing **Monorepo** approach and tooling",description:"\ud83d\udcd4 What is it - Choosing the right Monorepo tool and features for the boilerplate",source:"@site/docs/decisions/monorepo.md",sourceDirName:"decisions",slug:"/decisions/monorepo",permalink:"/decisions/monorepo",draft:!1,editUrl:"https://github.com/practicajs/practica/tree/main/docs/docs/decisions/monorepo.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,sidebar_label:"Monorepo"},sidebar:"tutorialSidebar",previous:{title:"Configuration Library",permalink:"/decisions/configuration-library"},next:{title:"OpenAPI",permalink:"/decisions/openapi"}},y={},a=[],i={toc:a},s="wrapper";function d(l){let{components:n,...e}=l;return(0,r.yg)(s,(0,t.A)({},i,e,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"decision-choosing-monorepo-approach-and-tooling"},"Decision: Choosing ",(0,r.yg)("strong",{parentName:"h1"},"Monorepo")," approach and tooling"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"\ud83d\udcd4 What is it")," - Choosing the right Monorepo tool and features for the boilerplate"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"\u23f0 Status")," - Open for discussions"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"\ud83d\udcc1 Corresponding discussion")," - ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/practicajs/practica/issues/80"},"Here")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"\ud83c\udfafBottom-line: our recommendation")," - TBD"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"\ud83d\udcca Detailed comparison table")),(0,r.yg)("small",null,"*For some lacking features there is a community package that bridges the gap; For workspace, we evaluated whether most of them support a specific feature"),(0,r.yg)("table",{valign:"top"},(0,r.yg)("tr",null,(0,r.yg)("td",null),(0,r.yg)("td",null,(0,r.yg)("h1",null,"nx")),(0,r.yg)("td",null,(0,r.yg)("h1",null,"Turborepo")),(0,r.yg)("td",null,(0,r.yg)("h1",null,"Lerna")),(0,r.yg)("td",null,(0,r.yg)("h1",null,"workspace (npm, yarn, pnpm)"))),(0,r.yg)("tr",null,(0,r.yg)("td",{colspan:"5",align:"center"},(0,r.yg)("h2",null,"Executive Summary"))),(0,r.yg)("tr",{valign:"top"},(0,r.yg)("td",null,(0,r.yg)("b",null,"Community and maintenance")),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/full.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"Huge eco-system and commercial-grade maintenance"),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/full.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"Trending, commercial-grade maintenance"),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/partial.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"Not maintained anymore"),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/almost-full.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"Solid")),(0,r.yg)("tr",{valign:"top"},(0,r.yg)("td",null,(0,r.yg)("b",null,"\u2757Encourage component autonomy")),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/partial.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"Packages are highly coupled"),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/almost-full.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"Workflow is coupled"),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/almost-full.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"npm link bypasses the SemVer"),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/full.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"Minor concern: shared NODE_MODULES on the root")),(0,r.yg)("tr",{valign:"top"},(0,r.yg)("td",null,(0,r.yg)("b",null,"Build speed")),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/full.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"Smart inference and execution plan, shared dependencies, cache"),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/full.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"Smart inference and execution plan, shared dependencies, cache"),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/partial.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"Parallel tasks execution, copied dependencies"),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/partial.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"Shared dependencies")),(0,r.yg)("tr",{valign:"top"},(0,r.yg)("td",null,(0,r.yg)("b",null,"Standardization")),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/partial.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"Non standard Node.js stuff: One single root package.json by default, TS-paths for linking"),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/full.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"An external build layer"),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/full.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"An external build layer"),(0,r.yg)("td",null,(0,r.yg)("img",{src:"/img/docs/decisions/full.png"}),(0,r.yg)("br",null),(0,r.yg)("br",null),"An external package centralizer")),(0,r.yg)("tr",null,(0,r.yg)("td",{class:"tg-ho3n",colspan:"5",align:"center"},(0,r.yg)("h2",null,"Tasks and build pipeline"))),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"Run recursive commands (affect a group of packages)")),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"\u2757\ufe0fParallel task execution")),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"No"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes* (Yarn & Pnpm)")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"\u2757\ufe0fRealize which packages changed")),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"No")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"\u2757\ufe0fRealize packages that are affected by a change")),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes",(0,r.yg)("br",null),"both through package.json and code"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes",(0,r.yg)("br",null),"through package.json"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"Ignore missing commands/scripts")),(0,r.yg)("td",null,(0,r.yg)("br",null),"No"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"\u2757\ufe0fIn-project cache - Skip tasks if local result exists")),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"No"),(0,r.yg)("td",null,(0,r.yg)("br",null),"No")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"Remote cache - Skip tasks if remote result exists")),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"No"),(0,r.yg)("td",null,(0,r.yg)("br",null),"No")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"Visual dependency graph")),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Partially, via plugin"),(0,r.yg)("td",null,(0,r.yg)("br",null),"No")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"\u2757\ufe0fSmart waterfall pipeline - Schedule unrelated tasks in parallel, not topologically")),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"No"),(0,r.yg)("td",null,(0,r.yg)("br",null),"No")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"Distributed task execution - Spread tasks across machines")),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"No"),(0,r.yg)("td",null,(0,r.yg)("br",null),"No"),(0,r.yg)("td",null,(0,r.yg)("br",null),"No")),(0,r.yg)("tr",null,(0,r.yg)("td",{class:"tg-ho3n",colspan:"5",align:"center"},(0,r.yg)("h2",null,"Locally linking packages"))),(0,r.yg)("tr",null,(0,r.yg)("td",null,"\u2757\ufe0fIs supported"),(0,r.yg)("td",null,"Partially",(0,r.yg)("br",null),"Achieved through TS paths"),(0,r.yg)("td",null,(0,r.yg)("br",null),"No",(0,r.yg)("br",null),"Relies on workspaces"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"How")),(0,r.yg)("td",null,(0,r.yg)("br",null),"\u2757\ufe0fVia TypeScript paths and webpack"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Relies on workspaces"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Symlink"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Symlink")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"\u2757\ufe0fCan opt-out?")),(0,r.yg)("td",null,"Yes",(0,r.yg)("br",null),"By default local packages are linked"),(0,r.yg)("td",null,"-"),(0,r.yg)("td",null,"No"),(0,r.yg)("td",null,"Partially",(0,r.yg)("br",null),"Pnpm allows preferring remote packages, Yarn has a [focused package](https://classic.yarnpkg.com/blog/2018/05/18/focused-workspaces/) option which only works per a single package")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"Link a range - only specific versions will be symlinked")),(0,r.yg)("td",null,"No"),(0,r.yg)("td",null,"-"),(0,r.yg)("td",null,"No"),(0,r.yg)("td",null,"Some",(0,r.yg)("br",null),"Yarn and Pnpm allows workspace versioning")),(0,r.yg)("tr",null,(0,r.yg)("td",{class:"tg-ho3n",colspan:"5",align:"center"},(0,r.yg)("h2",null,"Optimizing dependencies installation speed"))),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"Supported")),(0,r.yg)("td",null,"Yes",(0,r.yg)("br",null),"Via a single Root package.json and NODE_MODULES"),(0,r.yg)("td",null,"Yes",(0,r.yg)("br",null),"Via caching"),(0,r.yg)("td",null,"No",(0,r.yg)("br",null),"Can be used on top of yarn workspace"),(0,r.yg)("td",null,"Yes",(0,r.yg)("br",null),"Via single node_modules folder")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"Retain origin file path (some module refers to relative paths)")),"****",(0,r.yg)("td",null,"Partially",(0,r.yg)("br",null),"NODE_MODULES is on the root, not per package"),(0,r.yg)("td",null,"Yes"),(0,r.yg)("td",null,"Not relevant"),(0,r.yg)("td",null,"Partially",(0,r.yg)("br",null),"Pnpm uses hard link instead of symlinks")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"Keep single NODE_MODULES per machine (faster, less disc space)")),(0,r.yg)("td",null,"No",(0,r.yg)("br",null)),(0,r.yg)("td",null,"No"),(0,r.yg)("td",null,"No"),(0,r.yg)("td",null,"Partially",(0,r.yg)("br",null),"Pnpm supports this")),(0,r.yg)("tr",null,(0,r.yg)("td",{class:"tg-ho3n",colspan:"5",align:"center"},(0,r.yg)("h2",null,"Other features and considerations"))),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"Community plugins")),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"No"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"Scaffold new component from a gallery")),(0,r.yg)("td",null,(0,r.yg)("br",null),"Yes"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None"),(0,r.yg)("td",null,"Create a new package to the repo"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Built it code genreation with useful templates"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None, 3rd party code generator can be used"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None, 3rd party code generator can be used"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None, 3rd party code generator can be used")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"Adapt changes in the monorepo tool")),(0,r.yg)("td",null,(0,r.yg)("br",null),"Supported via nx migrate"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Supported via codemod"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"Incremental builds")),(0,r.yg)("td",null,(0,r.yg)("br",null),"Supported"),(0,r.yg)("td",null,(0,r.yg)("br",null),"Supported"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None")),(0,r.yg)("tr",null,(0,r.yg)("td",null,(0,r.yg)("b",null,"Cross-package modifications")),(0,r.yg)("td",null,(0,r.yg)("br",null),"Supported via nx generate"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None"),(0,r.yg)("td",null,(0,r.yg)("br",null),"None"))),(0,r.yg)("p",null,"__"),(0,r.yg)("p",null,"Ideas for next iteration:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Separate command execution and pipeline section"),(0,r.yg)("li",{parentName:"ul"},"Stars and popularity"),(0,r.yg)("li",{parentName:"ul"},"Features summary"),(0,r.yg)("li",{parentName:"ul"},"Polyrepo support")))}d.isMDXComponent=!0}}]);